<module>
<moduleprefs title="Google.com">
<content type="html"><!--[CDATA[

<!DOCTYPE html>
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/z-f3-f1/1@main/style.css">

<!-- GameMonetize SDK -->
<script id="gamemonetize-sdk" src="https://cdn.jsdelivr.net/gh/testamalame/sef@main/sedk.js"></script>
<script>
  window.SDK_OPTIONS = {
    gameId: "jp112o3o4hzgrnc7zaewjkrfk282pul8",
    onEvent: function (a) {
      switch (a.name) {
        case "SDK_GAME_PAUSE":
          if (typeof myGameInstance !== 'undefined' && myGameInstance) {
            myGameInstance.SendMessage('AudioManager', 'MuteAudio');
          }
          break;
        case "SDK_GAME_START":
          if (typeof myGameInstance !== 'undefined' && myGameInstance) {
            myGameInstance.SendMessage('AudioManager', 'UnmuteAudio');
          }
          break;
        case "SDK_READY":
          break;
      }
    }
  };
  (function (a, b, c) {
    var d = a.getElementsByTagName(b)[0];
    a.getElementById(c) || (a = a.createElement(b), a.id = c, a.src = "https://cdn.jsdelivr.net/gh/testamalame/sef@main/sedk.js", d.parentNode.insertBefore(a, d));
  })(document, "script", "gamemonetize-sdk");
</script>

<style>
  canvas:focus { outline: none; }
  html, body {
    padding: 0;
    margin: 0;
    overflow: hidden;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    height: 100%;
  }
  /* Optional: ensure canvas sits under your loader overlay */
  #unity-container { position: relative; width: 100%; height: 100%; }
  #unity-canvas { width: 100vw; height: 100vh; display:block; }
</style>

<!-- Unity container/canvas -->
<div id="unity-container" class="unity-desktop">
  <canvas id="unity-canvas" tabindex="-1" style="cursor: default;"></canvas>
</div>

<!-- YOUR custom loading screen (overlay) -->
<div id="loadingScreen" style="
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
">
  <img src="https://cdn.jsdelivr.net/gh/TOGZ819/togz8.com/media.png" alt="Loading Logo" style="max-width: 300px; margin-bottom: 20px;">
  <div id="loadingProgress" style="
    width: 300px;
    height: 20px;
    border-radius: 10px;
    overflow: hidden;
    background: transparent;
    border: 1px solid #ddd;
  ">
    <div id="loadingBar" style="
      width: 0%;
      height: 100%;
      background: #4caf50;
      border-radius: 10px;
      transition: width 0.2s ease;
    "></div>
  </div>
</div>

<script>
  // --- Loading screen controls ---
  function updateLoadingProgress(progress) {
    var loadingBar = document.getElementById('loadingBar');
    if (loadingBar) loadingBar.style.width = (progress * 100) + '%';
  }
  function hideLoadingScreen() {
    var loadingScreen = document.getElementById('loadingScreen');
    if (loadingScreen) loadingScreen.style.display = 'none';
  }

  // --- Unity boot config ---
  const buildUrl  = "https://cdn.jsdelivr.net/gh/z-f3-f1/1@main/Build";
  const loaderUrl = buildUrl + "/yandexBrotli.loader.js";
  const config = {
    dataUrl: buildUrl + "/yandexBrotli.data.br",
    frameworkUrl: buildUrl + "/yandexBrotli.framewor.js",
    streamingAssetsUrl: "StreamingAssets",
    companyName: "Brain massage",
    productName: "Supercar Battle Royale",
    productVersion: "0.0.197"
  };

  // Merge wasm parts then start Unity
  const wasmFiles = ["yandexBrotli.wasm.br.part1", "yandexBrotli.wasm.br.part2"];
  function loadAndMergeFiles(files, callback) {
    var merged = [];
    function next(i){
      if(i < files.length){
        fetch(buildUrl + "/" + files[i])
          .then(r => r.arrayBuffer())
          .then(b => { merged.push(new Uint8Array(b)); next(i+1); })
          .catch(e => console.error('Failed to load file:', files[i], e));
      } else {
        callback(new Blob(merged));
      }
    }
    next(0);
  }

  const container = document.querySelector("#unity-container");
  const canvas    = document.querySelector("#unity-canvas");

  if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
    container.className = "unity-mobile";
  }

  let myGameInstance = null;
  let isAdShown = false;

  function showAdOnClick() {
    if (!isAdShown && typeof sdk !== 'undefined' && typeof sdk.showBanner !== 'undefined') {
      sdk.showBanner();
      isAdShown = true;
    }
  }

  // Initialize Unity (single path)
  loadAndMergeFiles(wasmFiles, function(mergedWasmBlob) {
    const mergedWasmFile = URL.createObjectURL(mergedWasmBlob);
    config.codeUrl = mergedWasmFile;

    const script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = () => {
      createUnityInstance(canvas, config, (progress) => {
        // Hook Unity loader progress into your bar
        updateLoadingProgress(progress);
      }).then((unityInstance) => {
        myGameInstance = unityInstance;

        // Hide your loader once Unity reports ready
        hideLoadingScreen();

        // Register ad triggers after the game is ready
        canvas.addEventListener('pointerdown', showAdOnClick);
        canvas.addEventListener('touchstart', showAdOnClick);
      }).catch((message) => {
        alert(message);
      });
    };
    document.body.appendChild(script);
  });

  // Focus helpers
  function FocusGame() {
    window.focus();
    canvas.focus();
  }
  window.addEventListener('pointerdown', FocusGame);
  window.addEventListener('touchstart', FocusGame);

  // Stubbed platform functions (unchanged from your original)
  let ysdk = null;
  let environmentData = {
    language: "en", domain: "default_domain", deviceType: "desktop",
    isMobile: false, isDesktop: true, isTablet: false, isTV: false,
    appID: "default_app_id", browserLang: navigator.language || "en",
    payload: null, promptCanShow: false, reviewCanShow: false,
    platform: navigator.platform,
    browser: (function() {
      let ua = navigator.userAgent;
      if (ua.includes("YaBrowser")) return "Yandex";
      if (ua.includes("OPR") || ua.includes("Opera")) return "Opera";
      if (ua.includes("Firefox")) return "Firefox";
      if (ua.includes("MSIE") || ua.includes("Trident")) return "IE";
      if (ua.includes("Edge")) return "Edge";
      if (ua.includes("Chrome")) return "Chrome";
      if (ua.includes("Safari")) return "Safari";
      return "Other";
    })()
  };

  let cloudSaves = 'noData';
  let paymentsData = 'none';
  let playerData = 'noData';
  let player = null;
  let payments = null;
  let initGame = false;
  let nowFullAdOpen = false;

  function GetPayments() { console.warn("GetPayments is not implemented"); return Promise.resolve("none"); }
  function SaveCloud() { console.warn("SaveCloud is not implemented"); }
  function LoadCloud() { console.warn("LoadCloud is not implemented"); return Promise.resolve("noData"); }
  function InitPlayer() { console.warn("InitPlayer is not implemented"); return Promise.resolve("noData"); }
  function FullAdShow() { console.warn("FullAdShow is not implemented"); }
  function RewardedShow() { console.warn("RewardedShow is not implemented"); }
  function StickyAdActivity() { console.warn("StickyAdActivity is not implemented"); }
  function Review() { console.warn("Review is not implemented"); }
  function PromptShow() { console.warn("PromptShow is not implemented"); }
  function InitLeaderboards() { console.warn("InitLeaderboards is not implemented"); }
  function GetLeaderboardScores() { console.warn("GetLeaderboardScores is not implemented"); }
  function SetLeaderboardScores() { console.warn("SetLeaderboardScores is not implemented"); }
  function ConsumePurchase() { console.warn("ConsumePurchase is not implemented"); }
  function ConsumePurchases() { console.warn("ConsumePurchases is not implemented"); }
  function InitLeaderboard() { console.warn("InitLeaderboard is not implemented"); }
  function BuyPayments() { console.warn("BuyPayments is not implemented"); }

  function InitGame() {
    try {
      console.log('Init Game Success');
      initGame = true;
      if (nowFullAdOpen === true && myGameInstance != null) {
        myGameInstance.SendMessage('YandexGame', 'OpenFullAd');
      }
    } catch (error) {
      console.error("InitGame error:", error);
    }
  }

  window.addEventListener("unhandledrejection", function(event) {
    console.warn("Suppressed unhandled rejection:", event.reason);
    event.preventDefault();
  });
</script>

<!-- ===== Top Center Ad (unchanged) ===== -->
<style>
  #ad-container {
    position: fixed;
    top: 0; left: 50%;
    transform: translateX(-50%);
    width: min(728px, calc(100% - 20px));
    height: 90px;
    background: rgba(0,0,0,0.90);
    display: none;
    z-index: 10000; /* above loader (9999) once shown */
    border-radius: 0;
    overflow: hidden;
    box-shadow: 0 2px 12px rgba(0,0,0,0.45);
    box-sizing: border-box;
    transition: transform 0.5s ease-in-out;
  }
  #ad-container.hidden { transform: translate(-50%, -100%); }
  #ad-iframe {
    position: absolute;
    top: 0; left: 50%;
    transform: translateX(-50%);
    width: 745px; height: 90px; border: 0; display: block; overflow: hidden; pointer-events: auto;
    box-sizing: content-box; -ms-overflow-style: none; scrollbar-width: none;
  }
  #ad-iframe::-webkit-scrollbar { display: none; width: 0; height: 0; }
  #close-ad {
    position: absolute; top: 6px; right: 8px;
    background: #ff4d4d; color: #fff; border: none;
    padding: 5px 9px; font-size: 13px; border-radius: 4px;
    cursor: not-allowed; opacity: 0.72; z-index: 100000; display: flex; align-items: center;
  }
  #close-ad.enabled { cursor: pointer; opacity: 1; }
  #close-ad::before { content: '↑'; margin-right: 4px; }
  #ad-right-mask {
    position: absolute; top: 0; right: 0; width: 12px; height: 100%;
    pointer-events: none; background: linear-gradient(to right, rgba(0,0,0,0), rgba(0,0,0,0.9));
    z-index: 99999;
  }
  @media (max-width: 440px) {
    #ad-container { width: calc(100% - 12px); left: 50%; transform: translateX(-50%); border-radius: 0; }
    #ad-iframe { width: 708px; }
  }
</style>
<script>
  (function () {
    const showDelay = 2000;
    const countdownStart = 12;
    const reappearDelay = 25000;
    const adContainer = document.getElementById('ad-container');
    const closeBtn = document.getElementById('close-ad');

    function showAd() {
      adContainer.style.display = 'block';
      adContainer.classList.remove('hidden');
      adContainer.setAttribute('aria-hidden', 'false');

      let timeLeft = countdownStart;
      closeBtn.textContent = `Close (${timeLeft})`;
      closeBtn.disabled = true;
      closeBtn.classList.remove('enabled');

      const t = setInterval(() => {
        timeLeft--;
        if (timeLeft > 0) {
          closeBtn.textContent = `Close (${timeLeft})`;
        } else {
          clearInterval(t);
          closeBtn.disabled = false;
          closeBtn.classList.add('enabled');
          closeBtn.textContent = 'Close ↑';
        }
      }, 1000);
    }

    setTimeout(showAd, showDelay);

    closeBtn.addEventListener('click', () => {
      if (closeBtn.disabled) return;
      adContainer.classList.add('hidden');
      adContainer.setAttribute('aria-hidden', 'true');
      setTimeout(showAd, reappearDelay);
    });
  })();
</script>

]]></content>
</moduleprefs>
</module>
